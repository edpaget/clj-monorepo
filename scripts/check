#!/bin/bash

# Type checking script for Clojure monorepo

set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

cd "$ROOT_DIR"

if [ "$1" = "all" ]; then
    echo "Running type checking for all projects..."
    clojure -X build/build.clj check-all
elif [ -n "$1" ]; then
    if [ -d "$1" ] && [ -f "$1/deps.edn" ]; then
        echo "Running type checking for project: $1"
        cd "$1"
        clojure -M:lint
    else
        echo "Error: Project '$1' not found or missing deps.edn"
        exit 1
    fi
else
    echo "Usage: $0 [all|<project-name>]"
    echo ""
    echo "Examples:"
    echo "  $0 all           # Check all projects"
    echo "  $0 my-lib        # Check specific project"
    exit 1
fi